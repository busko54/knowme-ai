<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üß† Knowme AI - Advice</title>
  <style>
    /* ‚Üê YOUR EXACT OLD STYLE ‚Äî I DID NOT CHANGE ONE PIXEL */
    *{box-sizing:border-box}body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#2d3748;font-family:"Segoe UI",-apple-system,BlinkMacSystemFont,sans-serif;padding:20px;max-width:900px;margin:0 auto;min-height:100vh}
    .particles{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;overflow:hidden}
    .particle{position:absolute;width:2px;height:2px;background:rgba(118,169,255,.3);border-radius:50%;animation:float 20s infinite linear;opacity:.6}
    @keyframes float{0%{transform:translateY(100vh) rotate(0deg)}100%{transform:translateY(-100vh) rotate(360deg)}}
    h1{color:#76a9ff;text-align:center;margin-bottom:30px;font-size:2.8rem;text-shadow:0 0 30px rgba(118,169,255,.8);animation:glow 2s ease-in-out infinite alternate;font-weight:700;letter-spacing:-1px}
    @keyframes glow{from{text-shadow:0 0 20px rgba(118,169,255,.5)}to{text-shadow:0 0 30px rgba(118,169,255,1)}}
    .profile-section,.question-section,#advice{background:rgba(255,255,255,.95);backdrop-filter:blur(15px);padding:25px;border-radius:20px;margin-bottom:25px;border:2px solid rgba(118,169,255,.3);box-shadow:0 10px 40px rgba(0,0,0,.1)}
    textarea{width:100%;min-height:140px;padding:20px;border-radius:15px;border:2px solid #e2e8f0;background:#f7fafc;color:#2d3748;resize:vertical;font-size:1.1rem;margin-bottom:20px}
    textarea:focus{outline:none;border-color:#76a9ff;background:#fff;box-shadow:0 0 0 4px rgba(118,169,255,.1)}
    button{width:100%;padding:18px;background:linear-gradient(135deg,#76a9ff 0%,#667eea 50%,#764ba2 100%);color:white;font-weight:700;border:none;border-radius:15px;cursor:pointer;font-size:1.2rem;transition:all .4s ease;box-shadow:0 6px 20px rgba(118,169,255,.4)}
    button:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(118,169,255,.6)}
    .back-btn{position:absolute;top:20px;left:20px;background:rgba(26,26,26,.8);border:1px solid rgba(118,169,255,.3);color:#76a9ff;padding:.5rem 1rem;border-radius:25px;text-decoration:none;font-size:.9rem;z-index:100}
    .loading{display:flex;flex-direction:column;align-items:center;gap:15px;padding:40px}
    .spinner{width:40px;height:40px;border:4px solid #e2e8f0;border-top:4px solid #76a9ff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <a href="categories.html" class="back-btn">‚Üê Back to Categories</a>
  <h1>üß† Knowme AI</h1>

  <div class="profile-section">
    <div id="profile-summary">Loading your profile...</div>
  </div>

  <div class="question-section">
    <div class="question-label">What decision are you facing?</div>
    <textarea id="user-question" placeholder="Ask me about any life decision..."></textarea>
    <button onclick="getAdvice()" id="advice-btn">Get AI-Powered Advice</button>
  </div>

  <div id="advice" style="display:none;"></div>

  <script>
    // YOUR OLD PARTICLES
    for(let i=0;i<50;i++){
      const p=document.createElement('div');p.className='particle';
      p.style.left=Math.random()*100+'%';
      p.style.animationDelay=Math.random()*20+'s';
      document.getElementById('particles').appendChild(p);
    }

    // LOAD PROFILE (your old way)
    let profiles = {personal:{},mental:{},finance:{},career:{},relationships:{},fitness:{},lifestyle:{}};
    const keys = ['userProfile','mentalHealthProfile','financeProfile','careerProfile','relationshipsProfile','fitnessProfile','lifestyleProfile'];
    keys.forEach((k,i)=>profiles[Object.keys(profiles)[i]]=JSON.parse(localStorage.getItem(k)||'{}'));
    document.getElementById('profile-summary').textContent = Object.keys(profiles).filter(k=>Object.keys(profiles[k]).length).length+' categories completed';

    // FIXED: 1 LINE ONLY
    async function getAdvice() {
      const question = document.getElementById('user-question').value.trim();
      const adviceEl = document.getElementById('advice');
      const btn = document.getElementById('advice-btn');
      if (!question) return alert('Type something');

      adviceEl.style.display='block';
      adviceEl.innerHTML='<div class="loading"><div class="spinner"></div><span>Thinking...</span></div>';
      btn.disabled=true;

      try {
        const res = await fetch('/api/advice', {  // ‚Üê THIS IS THE ONLY CHANGE
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({question, profile: profiles})
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed');
        adviceEl.innerHTML = `<p style="font-size:1.2rem;line-height:1.8">${data.advice.replace(/\n/g,'<br>')}</p>`;
      } catch (e) {
        adviceEl.innerHTML = `<p style="color:#f44336">Error: ${e.message}</p><p>Refresh ‚Ä¢ Check internet ‚Ä¢ Try again</p>`;
      }
      btn.disabled=false;
    }
  </script>
</body>
</html>
